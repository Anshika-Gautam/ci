#!/bin/sh

set -e

export PACK_NAME=$(python ~/ci/.circle/validate.py "${CIRCLE_PROJECT_REPONAME}" pack.yaml ~/ci/.circle/pack.yaml.schema)
echo "Pack schema is valid"

cp ~/ci/.circle/Makefile "${CIRCLE_PROJECT_REPONAME}"

cd "${CIRCLE_PROJECT_REPONAME}"
make all

echo "Validated $PACK_NAME"
echo "export PACK_NAME=$PACK_NAME" >> ~/.circlerc
